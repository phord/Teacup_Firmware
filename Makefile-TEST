##############################################################################
#                                                                            #
# Teacup - Lean and efficient firmware for RepRap printers                   #
#                                                                            #
# by Triffid Hunter, Traumflug, jakepoz, Markus Hitter, many others          #
#                                                                            #
# This firmware is Copyright (c) ...                                         #
#   2009 - 2010 Michael Moon aka Triffid_Hunter                              #
#   2010 - 2013 Markus "Traumflug" Hitter <mah@jump-ing.de>                  #
#                                                                            #
# This program is free software; you can redistribute it and/or modify       #
# it under the terms of the GNU General Public License as published by       #
# the Free Software Foundation; either version 2 of the License, or          #
# (at your option) any later version.                                        #
#                                                                            #
# This program is distributed in the hope that it will be useful,            #
# but WITHOUT ANY WARRANTY; without even the implied warranty of             #
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              #
# GNU General Public License for more details.                               #
#                                                                            #
# You should have received a copy of the GNU General Public License          #
# along with this program; if not, write to the Free Software                #
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA #
#                                                                            #
##############################################################################

##############################################################################
#                                                                            #
# Makefile for build testing                                                 #
#                                                                            #
#   make -f Makefile-TEST                                                    #
#                                                                            #
##############################################################################

.PHONY: test sim-test FORCE
FORCE: ;

CONFIGS=$(wildcard config.*.h)
$(info ${CONFIGS} )
define test-make
	cp $1 config.h && \
	${MAKE} -f Makefile-AVR $2

endef

test: FORCE
	echo test
	$(foreach CONFIG_FILE, ${CONFIGS}, $(call test-make,${CONFIG_FILE}) )

sim-test: FORCE
	echo test
	$(foreach CONFIG_FILE, ${CONFIGS}, $(call test-make,${CONFIG_FILE},sim) )
